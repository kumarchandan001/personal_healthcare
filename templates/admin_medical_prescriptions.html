<!DOCTYPE html>
<html>
<head>
    <title>Admin - Medical Prescriptions</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { background-color: #333; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        .header-title { font-size: 20px; font-weight: bold; }
        nav { margin-top: 20px; background-color: white; padding: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        nav ul { list-style: none; padding: 0; margin: 0; display: flex; flex-wrap: wrap; }
        nav ul li { margin-right: 20px; margin-bottom: 5px; }
        nav ul li a { text-decoration: none; color: #333; font-weight: bold; }
        nav ul li a:hover { color: #4285f4; }
        .card { background-color: white; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; overflow: hidden; }
        .card-header { background-color: #4285f4; color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .card-body { padding: 15px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        tr:hover { background-color: #f5f5f5; }
        .logout { color: white; text-decoration: none; }
        .view-link { color: #4285f4; text-decoration: none; }
        .view-link:hover { text-decoration: underline; }
        .filters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filter-group { display: flex; align-items: center; }
        .filter-label { margin-right: 5px; font-weight: bold; }
        .filter-input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .search-box { flex-grow: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 200px; }
        .prescription-card { background-color: white; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; padding: 15px; }
        .prescription-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .prescription-doctor { font-size: 18px; font-weight: bold; }
        .prescription-date { color: #666; }
        .prescription-content { margin-bottom: 10px; }
        .prescription-patient { margin-bottom: 5px; }
        .prescription-diagnosis { font-weight: bold; color: #4285f4; margin-bottom: 5px; }
        .prescription-medications { background-color: #f8f8f8; padding: 10px; border-radius: 4px; white-space: pre-line; margin: 10px 0; }
        .prescription-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .prescription-user { background-color: #e8f4fd; padding: 3px 8px; border-radius: 3px; }
        .prescription-actions a { margin-left: 10px; color: #4285f4; text-decoration: none; }
        .prescription-actions a:hover { text-decoration: underline; }
        .pagination { display: flex; justify-content: center; margin-top: 20px; }
        .pagination a { padding: 8px 12px; margin: 0 5px; background-color: #f2f2f2; border-radius: 4px; text-decoration: none; color: #333; }
        .pagination a:hover { background-color: #ddd; }
        .pagination a.active { background-color: #4285f4; color: white; }
        .data-count { background-color: white; padding: 8px 15px; border-radius: 20px; color: #333; font-weight: bold; }
    </style>
</head>
<body>
    <header>
        <div class="header-title">Health Assistant Admin</div>
        <a href="{{ url_for('logout') }}" class="logout">Logout</a>
    </header>
    
    <div class="container">
        <nav>
            <ul>
                <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
                <li><a href="{{ url_for('users') }}">Users</a></li>
                <li><a href="{{ url_for('medical_records') }}">Medical Records</a></li>
                <li><a href="{{ url_for('activity_tracking') }}">Activity Tracking</a></li>
                <li><a href="{{ url_for('bmi_history') }}">BMI History</a></li>
                <li><a href="{{ url_for('health_monitoring') }}">Health Monitoring</a></li>
                <li><a href="{{ url_for('medical_prescriptions') }}">Medical Prescriptions</a></li>
            </ul>
        </nav>
        
        <h1>Medical Prescriptions</h1>
        
        <div class="filters">
            <input type="text" id="search-input" class="search-box" placeholder="Search by doctor, patient, diagnosis...">
            
            <div class="filter-group">
                <span class="filter-label">Sort by:</span>
                <select id="sort-by" class="filter-input">
                    <option value="date-desc">Date (Newest)</option>
                    <option value="date-asc">Date (Oldest)</option>
                    <option value="doctor">Doctor Name</option>
                    <option value="patient">Patient Name</option>
                </select>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <span>All Prescriptions</span>
                <span class="data-count">{{ prescriptions|length }} items</span>
            </div>
            <div class="card-body">
                {% if prescriptions %}
                    {% for prescription in prescriptions %}
                        <div class="prescription-card" data-doctor="{{ prescription.doctor_name }}" data-patient="{{ prescription.patient_name }}" data-diagnosis="{{ prescription.diagnosis }}">
                            <div class="prescription-header">
                                <div class="prescription-doctor">Dr. {{ prescription.doctor_name }}</div>
                                <div class="prescription-date">{{ prescription.created_at }}</div>
                            </div>
                            <div class="prescription-content">
                                <div class="prescription-patient">Patient: {{ prescription.patient_name }}</div>
                                {% if prescription.diagnosis %}
                                    <div class="prescription-diagnosis">Diagnosis: {{ prescription.diagnosis }}</div>
                                {% endif %}
                                
                                {% if prescription.medications %}
                                    <div class="prescription-medications">{{ prescription.medications }}</div>
                                {% endif %}
                                
                                {% if prescription.instructions %}
                                    <div><strong>Instructions:</strong> {{ prescription.instructions }}</div>
                                {% endif %}
                                
                                {% if prescription.follow_up %}
                                    <div><strong>Follow-up:</strong> {{ prescription.follow_up }}</div>
                                {% endif %}
                            </div>
                            <div class="prescription-footer">
                                <div class="prescription-user">User: <a href="{{ url_for('user_history', user_id=prescription.user_id) }}">{{ prescription.username }}</a></div>
                                <div class="prescription-actions">
                                    <a href="{{ url_for('user_history', user_id=prescription.user_id) }}">View User History</a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p style="text-align: center; color: #666;">No prescriptions found</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Pagination for large datasets -->
        {% if prescriptions|length > 20 %}
            <div class="pagination">
                <a href="#" class="active">1</a>
                <a href="#">2</a>
                <a href="#">3</a>
                <a href="#">Next â†’</a>
            </div>
        {% endif %}
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search-input');
            const sortBy = document.getElementById('sort-by');
            const prescriptionCards = document.querySelectorAll('.prescription-card');
            
            // Search functionality
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                prescriptionCards.forEach(card => {
                    const doctor = card.getAttribute('data-doctor').toLowerCase();
                    const patient = card.getAttribute('data-patient').toLowerCase();
                    const diagnosis = card.getAttribute('data-diagnosis')?.toLowerCase() || '';
                    const cardText = card.textContent.toLowerCase();
                    
                    if (doctor.includes(searchTerm) || patient.includes(searchTerm) || 
                        diagnosis.includes(searchTerm) || cardText.includes(searchTerm)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
            
            // Sort functionality
            sortBy.addEventListener('change', function() {
                const sortValue = this.value;
                const cardsList = Array.from(prescriptionCards);
                
                cardsList.sort((a, b) => {
                    if (sortValue === 'date-desc') {
                        return new Date(b.querySelector('.prescription-date').textContent) - 
                               new Date(a.querySelector('.prescription-date').textContent);
                    } else if (sortValue === 'date-asc') {
                        return new Date(a.querySelector('.prescription-date').textContent) - 
                               new Date(b.querySelector('.prescription-date').textContent);
                    } else if (sortValue === 'doctor') {
                        return a.getAttribute('data-doctor').localeCompare(b.getAttribute('data-doctor'));
                    } else if (sortValue === 'patient') {
                        return a.getAttribute('data-patient').localeCompare(b.getAttribute('data-patient'));
                    }
                });
                
                const cardContainer = document.querySelector('.card-body');
                cardsList.forEach(card => cardContainer.appendChild(card));
            });
        });
    </script>
</body>
</html> 