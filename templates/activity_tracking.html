{% extends "includes/layout.html" %}

{% block title %}Activity Tracking{% endblock %}

{% block additional_styles %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css">
<style>
  #activity-tracking {
    padding: 30px;
    max-width: 900px;
  }
  
  .dashboard-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
  }

  @media (max-width: 768px) {
    .dashboard-container {
      grid-template-columns: 1fr;
    }
  }
  
  .stat-card {
    background: linear-gradient(145deg, #f8f9fa, #ffffff);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  
  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
  }
  
  .stat-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(45deg, #3498db, #2980b9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    color: white;
    font-size: 24px;
  }
  
  .stat-info h3 {
    font-size: 28px;
    margin: 0;
    color: #2c3e50;
  }
  
  .stat-info p {
    color: #7f8c8d;
    margin: 5px 0 0;
  }
  
  .activity-input {
    background: #fff;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
  }
  
  .activity-input h3 {
    color: #2c3e50;
    margin-top: 0;
    position: relative;
    margin-bottom: 20px;
    padding-bottom: 10px;
  }
  
  .activity-input h3:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 50px;
    height: 3px;
    background-color: #3498db;
  }
  
  .input-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
  
  @media (max-width: 768px) {
    .input-grid {
      grid-template-columns: 1fr;
    }
  }
  
  .form-group {
    margin-bottom: 20px;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #34495e;
  }
  
  .form-group input, .form-group select {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    background-color: #f8f9fa;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  
  .form-group input:focus, .form-group select:focus {
    border-color: #3498db;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    outline: none;
  }
  
  .btn {
    background: linear-gradient(45deg, #3498db, #2980b9);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.3s, box-shadow 0.3s;
    display: inline-block;
    text-align: center;
  }
  
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(41, 128, 185, 0.4);
  }
  
  .chart-container {
    background: #fff;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
  }
  
  .activity-log {
    background: #fff;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }
  
  .activity-log h3 {
    color: #2c3e50;
    margin-top: 0;
    position: relative;
    margin-bottom: 20px;
    padding-bottom: 10px;
  }
  
  .activity-log h3:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 50px;
    height: 3px;
    background-color: #3498db;
  }
  
  .log-entry {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid #ecf0f1;
  }
  
  .log-type {
    font-weight: 600;
    color: #2c3e50;
  }
  
  .log-details {
    color: #7f8c8d;
  }
  
  .log-date {
    color: #95a5a6;
    font-size: 0.9rem;
  }
  
  .empty-log {
    text-align: center;
    padding: 30px 0;
    color: #95a5a6;
  }
  
  .empty-log i {
    font-size: 40px;
    margin-bottom: 10px;
    display: block;
  }
</style>
{% endblock %}

{% block content %}
<!-- Activity Tracking Section -->
<section id="activity-tracking">
  <h2>Activity Tracking</h2>
  
  <!-- Dashboard Stats -->
  <div class="dashboard-container">
    <div class="stat-card" id="steps-card">
      <div class="stat-icon">
        <i class="fas fa-walking"></i>
      </div>
      <div class="stat-info">
        <h3 id="total-steps">0</h3>
        <p>Total Steps</p>
      </div>
    </div>
    
    <div class="stat-card" id="calories-card">
      <div class="stat-icon">
        <i class="fas fa-fire"></i>
      </div>
      <div class="stat-info">
        <h3 id="total-calories">0</h3>
        <p>Calories Burned</p>
      </div>
    </div>
    
    <div class="stat-card" id="duration-card">
      <div class="stat-icon">
        <i class="fas fa-stopwatch"></i>
      </div>
      <div class="stat-info">
        <h3 id="total-duration">0</h3>
        <p>Active Minutes</p>
      </div>
    </div>
    
    <div class="stat-card" id="activities-card">
      <div class="stat-icon">
        <i class="fas fa-dumbbell"></i>
      </div>
      <div class="stat-info">
        <h3 id="total-activities">0</h3>
        <p>Activities Logged</p>
      </div>
    </div>
  </div>
  
  <!-- Activity Input Form -->
  <div class="activity-input">
    <h3>Log Your Activity</h3>
  <form id="activityForm">
      <div class="input-grid">
        <div class="form-group">
          <label for="activity-type">Activity Type</label>
          <select id="activity-type" required>
            <option value="">Select Activity</option>
            <option value="walking">Walking</option>
            <option value="running">Running</option>
            <option value="cycling">Cycling</option>
            <option value="swimming">Swimming</option>
            <option value="gym">Gym Workout</option>
            <option value="yoga">Yoga</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="activity-date">Date</label>
          <input type="date" id="activity-date" required>
        </div>
        
        <div class="form-group">
          <label for="steps">Steps</label>
          <input type="number" id="steps" placeholder="e.g., 5000" min="0">
        </div>
        
        <div class="form-group">
          <label for="calories-burned">Calories Burned (kcal)</label>
          <input type="number" id="calories-burned" placeholder="e.g., 300" min="0">
        </div>
        
        <div class="form-group">
          <label for="workout-duration">Duration (minutes)</label>
          <input type="number" id="workout-duration" placeholder="e.g., 45" min="0" required>
        </div>
        
        <div class="form-group">
          <label for="intensity">Intensity</label>
          <select id="intensity" required>
            <option value="low">Low</option>
            <option value="moderate">Moderate</option>
            <option value="high">High</option>
          </select>
        </div>
      </div>
      
      <div class="form-group">
        <label for="notes">Notes</label>
        <input type="text" id="notes" placeholder="Add any additional details...">
      </div>
      
      <button type="submit" class="btn">Log Activity</button>
  </form>
  </div>
  
  <!-- Activity Charts -->
  <div class="chart-container">
    <h3>Weekly Activity Summary</h3>
    <canvas id="activity-chart" height="250"></canvas>
  </div>
  
  <!-- Activity Log -->
  <div class="activity-log">
    <h3>Recent Activities</h3>
    <div id="log-entries">
      <div class="empty-log">
        <i class="fas fa-clipboard-list"></i>
        <p>No activities logged yet.</p>
      </div>
    </div>
  </div>
</section>



  {% endblock %}

{% block additional_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Debug the localStorage
    console.log("Initial localStorage:", localStorage.getItem('healthActivities'));
    
    // Set today's date as default (with timezone handling)
    const today = new Date();
    const dateInput = document.getElementById('activity-date');
    const formattedDate = today.toISOString().split('T')[0]; // Format as YYYY-MM-DD
    dateInput.value = formattedDate;
    
    // Initialize activity storage with proper error handling
    let activities = [];
    try {
      const storedActivities = localStorage.getItem('healthActivities');
      activities = storedActivities ? JSON.parse(storedActivities) : [];
      // Validate the parsed data is an array
      if (!Array.isArray(activities)) {
        console.error("Stored activities is not an array, resetting");
        activities = [];
        localStorage.setItem('healthActivities', JSON.stringify([]));
      }
    } catch (e) {
      console.error("Error parsing activities from localStorage:", e);
      localStorage.setItem('healthActivities', JSON.stringify([]));
    }
    
    // Update dashboard stats
    updateDashboardStats();
    
    // Update activity log
    updateActivityLog();
    
    // Initialize chart
    initActivityChart();
    
    // Handle form submission
    const activityForm = document.getElementById('activityForm');
    
    activityForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      try {
        // Get form values
        const activityTypeSelect = document.getElementById('activity-type');
        const activityType = activityTypeSelect.value;
        
        // Validate activity type
        if (!activityType) {
          alert("Please select an activity type");
          activityTypeSelect.focus();
          return;
        }
        
        const activityDate = document.getElementById('activity-date').value;
        if (!activityDate) {
          alert("Please select a date");
          document.getElementById('activity-date').focus();
          return;
        }
        
        const stepsInput = document.getElementById('steps');
        const caloriesBurnedInput = document.getElementById('calories-burned');
        const workoutDurationInput = document.getElementById('workout-duration');
        
        const steps = stepsInput.value ? parseInt(stepsInput.value) : 0;
        const caloriesBurned = caloriesBurnedInput.value ? parseInt(caloriesBurnedInput.value) : 0;
        const workoutDuration = workoutDurationInput.value ? parseInt(workoutDurationInput.value) : 0;
        
        const intensitySelect = document.getElementById('intensity');
        const intensity = intensitySelect.value;
        
        // Validate workout duration
        if (!workoutDuration) {
          alert("Please enter a duration for your activity");
          workoutDurationInput.focus();
          return;
        }
        
        // Validate intensity
        if (!intensity) {
          alert("Please select an intensity level");
          intensitySelect.focus();
          return;
        }
        
        const notes = document.getElementById('notes').value;
        
        // Create activity object with proper activity type
        const activity = {
          id: Date.now(),
          type: activityType,
          date: activityDate,
          steps: steps,
          calories: caloriesBurned,
          duration: workoutDuration,
          intensity: intensity,
          notes: notes,
          timestamp: new Date().toISOString()
        };
        
        // For activities that don't count steps, ensure steps is always 0
        if (activityType === 'cycling' || activityType === 'swimming' || activityType === 'yoga') {
          activity.steps = 0;
        }
        
        console.log("Logging activity:", activity); // Debug log
        
        // Add to activities array
        activities.unshift(activity);
        
        // Save to localStorage with error handling
        try {
          localStorage.setItem('healthActivities', JSON.stringify(activities));
          console.log("Updated localStorage:", localStorage.getItem('healthActivities'));
        } catch (error) {
          console.error("Error saving to localStorage:", error);
          alert("There was an error saving your activity. Please try again.");
          return;
        }
        
        // Update UI
        updateDashboardStats();
        updateActivityLog();
        updateActivityChart();
        
        // Show success message with activity type
        showSuccessMessage(activityType);
        
        // Reset form with proper defaults
        activityForm.reset();
        document.getElementById('activity-date').value = formattedDate;
        // Force intensity to have a default
        document.getElementById('intensity').value = 'moderate';
      } catch (error) {
        console.error("Error in form submission:", error);
        alert("An error occurred. Please try again.");
      }
    });
    
    // Function to update dashboard stats
    function updateDashboardStats() {
      try {
        // Calculate totals for the last 7 days
        const now = new Date();
        const sevenDaysAgo = new Date(now);
        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
        
        const recentActivities = activities.filter(activity => {
          try {
            const activityDate = new Date(activity.date + 'T00:00:00'); // Ensure proper date parsing
            return activityDate >= sevenDaysAgo;
          } catch (e) {
            console.error("Error parsing date in filter:", e, activity);
            return false;
          }
        });
        
        // Count activities by type
        const activityTypes = {};
        recentActivities.forEach(activity => {
          if (activity.type) {
            activityTypes[activity.type] = (activityTypes[activity.type] || 0) + 1;
          }
        });
        
        // Only count steps from activities that should have steps (exclude cycling, swimming, yoga)
        const totalSteps = recentActivities.reduce((sum, activity) => {
          if (activity.type === 'cycling' || activity.type === 'swimming' || activity.type === 'yoga') {
            return sum;
          }
          return sum + (activity.steps || 0);
        }, 0);
        
        const totalCalories = recentActivities.reduce((sum, activity) => sum + (activity.calories || 0), 0);
        const totalDuration = recentActivities.reduce((sum, activity) => sum + (activity.duration || 0), 0);
        
        // Update the dashboard
        document.getElementById('total-steps').textContent = totalSteps.toLocaleString();
        document.getElementById('total-calories').textContent = totalCalories.toLocaleString();
        document.getElementById('total-duration').textContent = totalDuration.toLocaleString();
        document.getElementById('total-activities').textContent = recentActivities.length;
        
        // Update activity icon based on most common activity
        const mostCommonActivity = Object.entries(activityTypes).sort((a, b) => b[1] - a[1])[0];
        if (mostCommonActivity) {
          const activityIcon = document.querySelector('#activities-card .stat-icon i');
          if (activityIcon) {
            // Set class based on most common activity
            activityIcon.className = 'fas';
            switch(mostCommonActivity[0]) {
              case 'walking':
                activityIcon.classList.add('fa-walking');
                break;
              case 'running':
                activityIcon.classList.add('fa-running');
                break;
              case 'cycling':
                activityIcon.classList.add('fa-biking');
                break;
              case 'swimming':
                activityIcon.classList.add('fa-swimmer');
                break;
              case 'gym':
                activityIcon.classList.add('fa-dumbbell');
                break;
              case 'yoga':
                activityIcon.classList.add('fa-om');
                break;
              default:
                activityIcon.classList.add('fa-dumbbell');
            }
          }
        }
      } catch (error) {
        console.error("Error updating dashboard stats:", error);
      }
    }
    
    // Function to update activity log
    function updateActivityLog() {
      try {
        const logEntriesContainer = document.getElementById('log-entries');
        
        if (!activities.length) {
          logEntriesContainer.innerHTML = `
            <div class="empty-log">
              <i class="fas fa-clipboard-list"></i>
              <p>No activities logged yet.</p>
            </div>
          `;
          return;
        }
        
        // Clear the container
        logEntriesContainer.innerHTML = '';
        
        // Show the 5 most recent activities
        const recentActivities = activities.slice(0, 5);
        
        recentActivities.forEach(activity => {
          try {
            const activityDate = new Date(activity.date + 'T00:00:00');
            const formattedDate = activityDate.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric'
            });
            
            // Fix for undefined activity type
            const activityType = activity.type || 'activity';
            const activityTypeCapitalized = activityType.charAt(0).toUpperCase() + activityType.slice(1);
            
            // Get appropriate icon based on activity type
            let activityIcon = 'fa-walking';
            switch(activityType) {
              case 'running':
                activityIcon = 'fa-running';
                break;
              case 'cycling':
                activityIcon = 'fa-biking';
                break;
              case 'swimming':
                activityIcon = 'fa-swimmer';
                break;
              case 'gym':
                activityIcon = 'fa-dumbbell';
                break;
              case 'yoga':
                activityIcon = 'fa-om';
                break;
              case 'other':
                activityIcon = 'fa-heartbeat';
                break;
              default:
                activityIcon = 'fa-walking';
            }
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
              <div>
                <div class="log-type"><i class="fas ${activityIcon}"></i> ${activityTypeCapitalized}</div>
                <div class="log-details">
                  ${activity.duration || 0} mins | ${activity.calories || 0} kcal 
                  ${(activity.steps && activity.type !== 'cycling' && activity.type !== 'swimming' && activity.type !== 'yoga') ? `| ${activity.steps} steps` : ''}
                  ${activity.notes ? `<br><small>${activity.notes}</small>` : ''}
                </div>
              </div>
              <div class="log-date">${formattedDate}</div>
            `;
            
            // Add delete functionality
            logEntry.addEventListener('click', function() {
              if (confirm(`Are you sure you want to delete this ${activityTypeCapitalized} activity?`)) {
                activities = activities.filter(a => a.id !== activity.id);
                localStorage.setItem('healthActivities', JSON.stringify(activities));
                updateDashboardStats();
                updateActivityLog();
                updateActivityChart();
              }
            });
            
            logEntriesContainer.appendChild(logEntry);
          } catch (error) {
            console.error("Error rendering activity:", error, activity);
          }
        });
      } catch (error) {
        console.error("Error updating activity log:", error);
      }
    }
    
    // Function to initialize activity chart
    function initActivityChart() {
      try {
        const ctx = document.getElementById('activity-chart').getContext('2d');
        
        // Create the chart
        window.activityChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [
              {
                label: 'Duration (mins)',
                data: [0, 0, 0, 0, 0, 0, 0],
                backgroundColor: 'rgba(52, 152, 219, 0.7)',
                borderColor: 'rgba(41, 128, 185, 1.0)',
                borderWidth: 1
              },
              {
                label: 'Calories',
                data: [0, 0, 0, 0, 0, 0, 0],
                backgroundColor: 'rgba(231, 76, 60, 0.7)',
                borderColor: 'rgba(192, 57, 43, 1.0)',
                borderWidth: 1
              }
            ]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'top',
              },
              title: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
        
        // Update with initial data
        updateActivityChart();
      } catch (error) {
        console.error("Error initializing chart:", error);
        document.querySelector('.chart-container').innerHTML = '<p>Error loading chart</p>';
      }
    }
    
    // Function to update activity chart
    function updateActivityChart() {
      try {
        if (!window.activityChart) {
          console.error("Chart not initialized");
          return;
        }
        
        // Get the week days
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const today = new Date();
        const dayOfWeek = today.getDay(); // 0 is Sunday
        
        const labels = [];
        for (let i = 6; i >= 0; i--) {
          const dayIndex = (dayOfWeek - i + 7) % 7;
          labels.unshift(days[dayIndex]);
        }
        
        // Initialize data arrays
        const durationData = [0, 0, 0, 0, 0, 0, 0];
        const caloriesData = [0, 0, 0, 0, 0, 0, 0];
        
        // Calculate data for last 7 days
        const now = new Date();
        const oneDay = 24 * 60 * 60 * 1000; // Hours*minutes*seconds*milliseconds
        
        activities.forEach(activity => {
          try {
            const activityDate = new Date(activity.date + 'T00:00:00');
            const diffDays = Math.round(Math.abs((now - activityDate) / oneDay));
            
            if (diffDays <= 6) { // 0 to 6 days ago (total 7 days)
              const dayIndex = 6 - diffDays; // 6 is today, 0 is 6 days ago
              durationData[dayIndex] += (activity.duration || 0);
              caloriesData[dayIndex] += (activity.calories || 0);
            }
          } catch (e) {
            console.error("Error processing activity for chart:", e, activity);
          }
        });
        
        // Update chart data
        window.activityChart.data.labels = labels;
        window.activityChart.data.datasets[0].data = durationData;
        window.activityChart.data.datasets[1].data = caloriesData;
        window.activityChart.update();
      } catch (error) {
        console.error("Error updating chart:", error);
      }
    }
    
    // Function to show success message
    function showSuccessMessage(activityType) {
      try {
        const capitalizedType = activityType.charAt(0).toUpperCase() + activityType.slice(1);
        const successMessage = document.createElement('div');
        successMessage.style.position = 'fixed';
        successMessage.style.top = '20px';
        successMessage.style.left = '50%';
        successMessage.style.transform = 'translateX(-50%)';
        successMessage.style.padding = '15px 25px';
        successMessage.style.backgroundColor = '#2ecc71';
        successMessage.style.color = 'white';
        successMessage.style.borderRadius = '5px';
        successMessage.style.boxShadow = '0 4px 10px rgba(0, 0, 0, 0.2)';
        successMessage.style.zIndex = '1000';
        successMessage.textContent = `${capitalizedType} activity logged successfully!`;
        
        document.body.appendChild(successMessage);
        
        // Fade out and remove after 3 seconds
        setTimeout(() => {
          successMessage.style.opacity = '0';
          successMessage.style.transition = 'opacity 0.5s ease';
          
      setTimeout(() => {
            if (document.body.contains(successMessage)) {
              document.body.removeChild(successMessage);
            }
          }, 500);
        }, 3000);
      } catch (error) {
        console.error("Error showing success message:", error);
      }
    }
    
    // Show detailed stats when clicking on dashboard cards
    document.querySelectorAll('.stat-card').forEach(card => {
      card.addEventListener('click', function() {
        try {
          const cardId = this.id;
          
          let message = '';
          
          switch(cardId) {
            case 'steps-card':
              // Count non-zero step activities (exclude non-step activities)
              const steppingActivities = activities.filter(a => 
                a.type !== 'cycling' && a.type !== 'swimming' && a.type !== 'yoga' && a.steps > 0
              );
              
              const totalStepsAll = steppingActivities.reduce((sum, a) => sum + (a.steps || 0), 0);
              const avgSteps = steppingActivities.length ? Math.round(totalStepsAll / steppingActivities.length) : 0;
              
              if (steppingActivities.length > 0) {
                message = `Your average steps per walking/running activity: ${avgSteps}.\nAim for 10,000 steps daily for optimal health!`;
              } else {
                message = `No step-based activities recorded yet.\nAim for 10,000 steps daily for walking activities.`;
              }
              break;
            case 'calories-card':
              const totalCals = activities.reduce((sum, a) => sum + (a.calories || 0), 0);
              message = `You've burned a total of ${totalCals} calories.\nGreat job on your fitness journey!`;
              break;
            case 'duration-card':
              const totalMins = activities.reduce((sum, a) => sum + (a.duration || 0), 0);
              const hours = Math.floor(totalMins / 60);
              const mins = totalMins % 60;
              message = `Total active time: ${hours}h ${mins}m.\nThe recommended weekly activity is 150 minutes!`;
              break;
            case 'activities-card':
              const types = {};
              activities.forEach(a => {
                if (a.type) {
                  types[a.type] = (types[a.type] || 0) + 1;
                }
              });
              const entries = Object.entries(types);
              const favActivity = entries.length > 0 ? entries.sort((a, b) => b[1] - a[1])[0] : null;
              message = favActivity 
                ? `Your favorite activity is ${favActivity[0]} (${favActivity[1]} times).\nVariety in exercise is great for overall fitness!` 
                : 'Start logging activities to see insights!';
              break;
          }
          
          alert(message);
        } catch (error) {
          console.error("Error showing stats card details:", error);
        }
      });
    });
    
    // Add suggested values based on activity type
    document.getElementById('activity-type').addEventListener('change', function() {
      try {
        const activityType = this.value;
        const stepsInput = document.getElementById('steps');
        const caloriesInput = document.getElementById('calories-burned');
        const durationInput = document.getElementById('workout-duration');
        const intensitySelect = document.getElementById('intensity');
        
        // Reset values
        stepsInput.value = '';
        caloriesInput.value = '';
        durationInput.value = '';
        
        // For activities that don't typically count steps, hide or disable the steps field
        if (activityType === 'cycling' || activityType === 'swimming' || activityType === 'yoga') {
          stepsInput.value = '0';
          stepsInput.disabled = true;
          stepsInput.style.backgroundColor = '#f0f0f0';
        } else {
          stepsInput.disabled = false;
          stepsInput.style.backgroundColor = '#f8f9fa';
        }
        
        // Set suggested values based on activity type
        switch(activityType) {
          case 'walking':
            stepsInput.placeholder = 'e.g., 5000';
            caloriesInput.placeholder = 'e.g., 200';
            durationInput.placeholder = 'e.g., 45';
            intensitySelect.value = 'low';
            break;
          case 'running':
            stepsInput.placeholder = 'e.g., 6000';
            caloriesInput.placeholder = 'e.g., 500';
            durationInput.placeholder = 'e.g., 30';
            intensitySelect.value = 'high';
            break;
          case 'cycling':
            stepsInput.placeholder = 'Not applicable';
            caloriesInput.placeholder = 'e.g., 400';
            durationInput.placeholder = 'e.g., 60';
            intensitySelect.value = 'moderate';
            break;
          case 'swimming':
            stepsInput.placeholder = 'Not applicable';
            caloriesInput.placeholder = 'e.g., 450';
            durationInput.placeholder = 'e.g., 45';
            intensitySelect.value = 'high';
            break;
          case 'gym':
            stepsInput.placeholder = 'e.g., 2000';
            caloriesInput.placeholder = 'e.g., 350';
            durationInput.placeholder = 'e.g., 60';
            intensitySelect.value = 'high';
            break;
          case 'yoga':
            stepsInput.placeholder = 'Not applicable';
            caloriesInput.placeholder = 'e.g., 200';
            durationInput.placeholder = 'e.g., 60';
            intensitySelect.value = 'low';
            break;
          case 'other':
            stepsInput.placeholder = 'if applicable';
            caloriesInput.placeholder = 'e.g., 250';
            durationInput.placeholder = 'e.g., 45';
            intensitySelect.value = 'moderate';
            break;
          default:
            stepsInput.placeholder = 'e.g., 2000';
            caloriesInput.placeholder = 'e.g., 300';
            durationInput.placeholder = 'e.g., 45';
            intensitySelect.value = 'moderate';
        }
      } catch (error) {
        console.error("Error updating form based on activity type:", error);
      }
    });
    
    // Add a clear all function for debugging
    window.clearAllActivities = function() {
      if (confirm('This will delete ALL your activity data. Are you sure?')) {
        localStorage.removeItem('healthActivities');
        activities = [];
        updateDashboardStats();
        updateActivityLog();
        updateActivityChart();
        alert('All activity data has been cleared.');
      }
    };
  });
</script>
{% endblock %}